(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97593,e=>{"use strict";var t=e.i(45425),s=e.i(39656),a=e.i(89082),r=e.i(34407);let l=s.forwardRef(({className:e,type:s,...a},l)=>(0,t.jsx)("input",{type:s,className:(0,r.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...a}));l.displayName="Input";var i=e.i(13882),d=e.i(83648),n=e.i(86299),o=e.i(95675),c=e.i(43718),m=e.i(55553),u=e.i(55013);let x=(0,u.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),h=(0,u.default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),p=(0,u.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var g=e.i(13325);let _=`month,avg_temp_taipei,epidemic_index,gt_flu,gt_cold,gt_immunity,gt_competitor_total,has_bundle_promo,bundle_discount_rate,bundle_start_date,bundle_duration_days,has_bulk_promo,bulk_discount_rate,season_event_tag,historical_m1_month,historical_m1_qty,historical_m2_month,historical_m2_qty,historical_m3_month,historical_m3_qty
2025-11,18.5,45.2,62,55,48,120,true,0.30,2025-11-05,14,false,0,,2025-08,668,2025-09,316,2025-10,904`;function j({cat:e}){let s=g.CATEGORY_COLORS[e];return(0,t.jsx)(d.Badge,{variant:"outline",style:{color:s,borderColor:s},className:"font-semibold",children:e})}function f({label:e,value:s,color:a}){return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:e}),(0,t.jsxs)("span",{children:[(100*s).toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"h-2 bg-secondary rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${100*s}%`,backgroundColor:a}})})]})}function b(){let[e,r]=(0,s.useState)("gpt-4o"),[u,b]=(0,s.useState)("vB"),[y,v]=(0,s.useState)(""),[N,w]=(0,s.useState)(""),[C,S]=(0,s.useState)(!1),[k,O]=(0,s.useState)(null),[P,A]=(0,s.useState)(!1),[R,I]=(0,s.useState)(null),[L,T]=(0,s.useState)(null),E=(0,s.useRef)(null),M="gpt-4o"===e||"mini"===e,F="haiku"===e,B=M&&!y.trim()||F&&!N.trim(),H=async()=>{if(!k)return void I("Please select a CSV file.");if(B)return void I("Please enter the required API key.");A(!0),I(null),T(null);try{let t=(await k.text()).trim().split("\n");if(t.length<2)throw Error("CSV must have a header row and at least one data row.");let s=t[0].split(",").map(e=>e.trim()),a=t[1].split(",").map(e=>e.trim()),r=Object.fromEntries(s.map((e,t)=>[e,a[t]??""])),l=[];for(let e=1;e<=7;e++){let t=r[`historical_m${e}_month`],s=r[`historical_m${e}_qty`];t&&s&&l.push({month:t,qty:parseInt(s)})}let i={month:r.month,avg_temp_taipei:parseFloat(r.avg_temp_taipei),epidemic_index:parseFloat(r.epidemic_index),gt_flu:parseInt(r.gt_flu),gt_cold:parseInt(r.gt_cold),gt_immunity:parseInt(r.gt_immunity),gt_competitor_total:parseFloat(r.gt_competitor_total),has_bundle_promo:r.has_bundle_promo?.toLowerCase()==="true",bundle_discount_rate:parseFloat(r.bundle_discount_rate)||0,bundle_start_date:r.bundle_start_date||"",bundle_duration_days:parseInt(r.bundle_duration_days)||0,has_bulk_promo:r.has_bulk_promo?.toLowerCase()==="true",bulk_discount_rate:parseFloat(r.bulk_discount_rate)||0,season_event_tag:r.season_event_tag||"",historical_sales:l},d=await fetch("/api/health-predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({features:i,model:e,version:u,openai_api_key:M?y.trim():void 0,anthropic_api_key:F?N.trim():void 0})}),n=await d.json();if(!d.ok)throw Error(n.error??"Prediction failed");T(n.result)}catch(e){I(e instanceof Error?e.message:"Unknown error")}finally{A(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsxs)("main",{className:"container mx-auto px-4 py-6 space-y-6 max-w-3xl",children:[(0,t.jsxs)(i.Card,{className:"border-border",children:[(0,t.jsxs)(i.CardHeader,{className:"pb-4",children:[(0,t.jsx)(i.CardTitle,{className:"text-lg font-medium",children:"Upload & Predict"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Upload a month's feature CSV and get an instant L/M/H sales prediction. Your API key is sent directly to the provider and never stored."})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Model"}),(0,t.jsxs)(n.Select,{value:e,onValueChange:e=>r(e),children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsx)(n.SelectContent,{children:g.MODELS.map(e=>(0,t.jsx)(n.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Prompt Version"}),(0,t.jsxs)(n.Select,{value:u,onValueChange:e=>b(e),children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsx)(n.SelectContent,{children:g.VERSIONS.map(e=>(0,t.jsxs)(n.SelectItem,{value:e.value,children:[e.label," — ",e.description]},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3 p-4 rounded-lg border border-border bg-secondary/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",children:["API Key ",M?"(OpenAI)":"(Anthropic)"]}),(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>S(!C),children:C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{className:"h-4 w-4 mr-1"})," Hide"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Eye,{className:"h-4 w-4 mr-1"})," Show"]})})]}),M&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground",children:"OpenAI API Key"}),(0,t.jsx)(l,{type:C?"text":"password",placeholder:"sk-...",value:y,onChange:e=>v(e.target.value)})]}),F&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground",children:"Anthropic API Key"}),(0,t.jsx)(l,{type:C?"text":"password",placeholder:"sk-ant-...",value:N,onChange:e=>w(e.target.value)})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Key is forwarded directly to the provider. Not stored or logged."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Feature CSV"}),(0,t.jsxs)(a.Button,{variant:"ghost",size:"sm",onClick:()=>{let e=new Blob([_],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="health_food_template.csv",s.click(),URL.revokeObjectURL(t)},children:[(0,t.jsx)(h,{className:"h-4 w-4 mr-1"})," Download Template"]})]}),(0,t.jsx)(l,{type:"file",accept:".csv",ref:E,onChange:e=>{e.target.files?.[0]&&O(e.target.files[0])}}),k&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Selected: ",k.name]})]}),(0,t.jsx)(a.Button,{className:"w-full",onClick:H,disabled:!k||P||B,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"})," Predicting…"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.UploadCloud,{className:"mr-2 h-4 w-4"})," Get Prediction"]})})]})]}),R&&(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/40 bg-destructive/5 text-destructive text-sm",children:[(0,t.jsx)(p,{className:"h-4 w-4 mt-0.5 shrink-0"}),(0,t.jsx)("span",{children:R})]}),P&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Generating prediction…"})]}),!P&&L&&(0,t.jsxs)(i.Card,{className:"border-border",children:[(0,t.jsx)(i.CardHeader,{className:"pb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(i.CardTitle,{className:"text-lg font-medium",children:"Prediction Result"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Badge,{variant:"secondary",children:g.MODELS.find(t=>t.value===e)?.label}),(0,t.jsx)(d.Badge,{variant:"outline",children:u})]})]})}),(0,t.jsxs)(i.CardContent,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Predicted Sales Category"}),(0,t.jsx)(j,{cat:L.pred_class})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(f,{label:"P(Low)  — ≤ 363 bottles",value:L.prob_L,color:g.CATEGORY_COLORS.Low}),(0,t.jsx)(f,{label:"P(Mid)  — 364–446 bottles",value:L.prob_M,color:g.CATEGORY_COLORS.Mid}),(0,t.jsx)(f,{label:"P(High) — ≥ 447 bottles",value:L.prob_H,color:g.CATEGORY_COLORS.High})]}),L.step1_b&&(0,t.jsxs)("div",{className:"p-4 rounded-lg border border-border bg-secondary/20 space-y-2",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Step 1 Reasoning — Active Purchase Drivers [B]"}),(0,t.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:L.step1_b})]})]})]}),!P&&!L&&!R&&(0,t.jsx)("div",{className:"text-center py-12 text-muted-foreground text-sm",children:"Upload a CSV and click Get Prediction to see results here."})]}),(0,t.jsx)("footer",{className:"border-t border-border mt-8",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"AI-Army EBI Framework · Health Food Sales Prediction"})})})]})}e.s(["default",()=>b],97593)}]);