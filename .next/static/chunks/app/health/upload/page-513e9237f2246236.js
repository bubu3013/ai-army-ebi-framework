(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{68433:(e,t,a)=>{Promise.resolve().then(a.bind(a,20538))},20538:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var r=a(95155),s=a(12115),l=a(14085),n=a(29602);let i=s.forwardRef((e,t)=>{let{className:a,type:s,...l}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});i.displayName="Input";var d=a(35007),o=a(39286),c=a(50745),m=a(67401);let u=(0,m.A)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var p=a(92598);let x=(0,m.A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var h=a(14505),f=a(53608);let v=(0,m.A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var g=a(90051);function b(e){let{cat:t}=e,a=g.Gv[t];return(0,r.jsx)(o.E,{variant:"outline",style:{color:a,borderColor:a},className:"font-semibold",children:t})}function y(e){let{label:t,value:a,color:s}=e;return(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,r.jsx)("span",{children:t}),(0,r.jsxs)("span",{children:[(100*a).toFixed(0),"%"]})]}),(0,r.jsx)("div",{className:"h-2 bg-secondary rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full rounded-full transition-all duration-500",style:{width:"".concat(100*a,"%"),backgroundColor:s}})})]})}function j(){var e;let[t,a]=(0,s.useState)("gpt-4o"),[n,m]=(0,s.useState)("vB"),[j,N]=(0,s.useState)(""),[_,w]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[A,P]=(0,s.useState)(null),[R,S]=(0,s.useState)(!1),[F,I]=(0,s.useState)(null),[L,M]=(0,s.useState)(null),q=(0,s.useRef)(null),E="gpt-4o"===t||"mini"===t,V="haiku"===t,H=E&&!j.trim()||V&&!_.trim(),U=async()=>{if(!A){I("Please select a CSV file.");return}if(H){I("Please enter the required API key.");return}S(!0),I(null),M(null);try{var e,a,r;let s=(await A.text()).trim().split("\n");if(s.length<2)throw Error("CSV must have a header row and at least one data row.");let l=s[0].split(",").map(e=>e.trim()),i=s[1].split(",").map(e=>e.trim()),d=Object.fromEntries(l.map((e,t)=>{var a;return[e,null!==(a=i[t])&&void 0!==a?a:""]})),o=[];for(let e=1;e<=7;e++){let t=d["historical_m".concat(e,"_month")],a=d["historical_m".concat(e,"_qty")];t&&a&&o.push({month:t,qty:parseInt(a)})}let c={month:d.month,avg_temp_taipei:parseFloat(d.avg_temp_taipei),epidemic_index:parseFloat(d.epidemic_index),gt_flu:parseInt(d.gt_flu),gt_cold:parseInt(d.gt_cold),gt_immunity:parseInt(d.gt_immunity),gt_competitor_total:parseFloat(d.gt_competitor_total),has_bundle_promo:(null===(e=d.has_bundle_promo)||void 0===e?void 0:e.toLowerCase())==="true",bundle_discount_rate:parseFloat(d.bundle_discount_rate)||0,bundle_start_date:d.bundle_start_date||"",bundle_duration_days:parseInt(d.bundle_duration_days)||0,has_bulk_promo:(null===(a=d.has_bulk_promo)||void 0===a?void 0:a.toLowerCase())==="true",bulk_discount_rate:parseFloat(d.bulk_discount_rate)||0,season_event_tag:d.season_event_tag||"",historical_sales:o},m=await fetch("/api/health-predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({features:c,model:t,version:n,openai_api_key:E?j.trim():void 0,anthropic_api_key:V?_.trim():void 0})}),u=await m.json();if(!m.ok)throw Error(null!==(r=u.error)&&void 0!==r?r:"Prediction failed");M(u.result)}catch(e){I(e instanceof Error?e.message:"Unknown error")}finally{S(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsxs)("main",{className:"container mx-auto px-4 py-6 space-y-6 max-w-3xl",children:[(0,r.jsxs)(d.Zp,{className:"border-border",children:[(0,r.jsxs)(d.aR,{className:"pb-4",children:[(0,r.jsx)(d.ZB,{className:"text-lg font-medium",children:"Upload & Predict"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Upload a month's feature CSV and get an instant L/M/H sales prediction. Your API key is sent directly to the provider and never stored."})]}),(0,r.jsxs)(d.Wu,{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Model"}),(0,r.jsxs)(c.l6,{value:t,onValueChange:e=>a(e),children:[(0,r.jsx)(c.bq,{children:(0,r.jsx)(c.yv,{})}),(0,r.jsx)(c.gC,{children:g.L6.map(e=>(0,r.jsx)(c.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Prompt Version"}),(0,r.jsxs)(c.l6,{value:n,onValueChange:e=>m(e),children:[(0,r.jsx)(c.bq,{children:(0,r.jsx)(c.yv,{})}),(0,r.jsx)(c.gC,{children:g.S8.map(e=>(0,r.jsxs)(c.eb,{value:e.value,children:[e.label," — ",e.description]},e.value))})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3 p-4 rounded-lg border border-border bg-secondary/20",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("p",{className:"text-sm font-medium",children:["API Key ",E?"(OpenAI)":"(Anthropic)"]}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>C(!k),children:k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u,{className:"h-4 w-4 mr-1"})," Hide"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:"h-4 w-4 mr-1"})," Show"]})})]}),E&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"OpenAI API Key"}),(0,r.jsx)(i,{type:k?"text":"password",placeholder:"sk-...",value:j,onChange:e=>N(e.target.value)})]}),V&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Anthropic API Key"}),(0,r.jsx)(i,{type:k?"text":"password",placeholder:"sk-ant-...",value:_,onChange:e=>w(e.target.value)})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Key is forwarded directly to the provider. Not stored or logged."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Feature CSV"}),(0,r.jsxs)(l.$,{variant:"ghost",size:"sm",onClick:()=>{let e=new Blob(["month,avg_temp_taipei,epidemic_index,gt_flu,gt_cold,gt_immunity,gt_competitor_total,has_bundle_promo,bundle_discount_rate,bundle_start_date,bundle_duration_days,has_bulk_promo,bulk_discount_rate,season_event_tag,historical_m1_month,historical_m1_qty,historical_m2_month,historical_m2_qty,historical_m3_month,historical_m3_qty\n2025-11,18.5,45.2,62,55,48,120,true,0.30,2025-11-05,14,false,0,,2025-08,668,2025-09,316,2025-10,904"],{type:"text/csv"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="health_food_template.csv",a.click(),URL.revokeObjectURL(t)},children:[(0,r.jsx)(x,{className:"h-4 w-4 mr-1"})," Download Template"]})]}),(0,r.jsx)(i,{type:"file",accept:".csv",ref:q,onChange:e=>{var t;(null===(t=e.target.files)||void 0===t?void 0:t[0])&&P(e.target.files[0])}}),A&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Selected: ",A.name]})]}),(0,r.jsx)(l.$,{className:"w-full",onClick:U,disabled:!A||R||H,children:R?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"})," Predicting…"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Get Prediction"]})})]})]}),F&&(0,r.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/40 bg-destructive/5 text-destructive text-sm",children:[(0,r.jsx)(v,{className:"h-4 w-4 mt-0.5 shrink-0"}),(0,r.jsx)("span",{children:F})]}),R&&(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Generating prediction…"})]}),!R&&L&&(0,r.jsxs)(d.Zp,{className:"border-border",children:[(0,r.jsx)(d.aR,{className:"pb-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(d.ZB,{className:"text-lg font-medium",children:"Prediction Result"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.E,{variant:"secondary",children:null===(e=g.L6.find(e=>e.value===t))||void 0===e?void 0:e.label}),(0,r.jsx)(o.E,{variant:"outline",children:n})]})]})}),(0,r.jsxs)(d.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Predicted Sales Category"}),(0,r.jsx)(b,{cat:L.pred_class})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(y,{label:"P(Low)  — ≤ 363 bottles",value:L.prob_L,color:g.Gv.Low}),(0,r.jsx)(y,{label:"P(Mid)  — 364–446 bottles",value:L.prob_M,color:g.Gv.Mid}),(0,r.jsx)(y,{label:"P(High) — ≥ 447 bottles",value:L.prob_H,color:g.Gv.High})]}),L.step1_b&&(0,r.jsxs)("div",{className:"p-4 rounded-lg border border-border bg-secondary/20 space-y-2",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Step 1 Reasoning — Active Purchase Drivers [B]"}),(0,r.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:L.step1_b})]})]})]}),!R&&!L&&!F&&(0,r.jsx)("div",{className:"text-center py-12 text-muted-foreground text-sm",children:"Upload a CSV and click Get Prediction to see results here."})]}),(0,r.jsx)("footer",{className:"border-t border-border mt-8",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"AI-Army EBI Framework \xb7 Health Food Sales Prediction"})})})]})}},39286:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var r=a(95155);a(12115);var s=a(31027),l=a(29602);let n=(0,s.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)(n({variant:a}),t),...s})}},14085:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var r=a(95155),s=a(12115),l=a(12317),n=a(31027),i=a(29602);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:o=!1,...c}=e,m=o?l.DX:"button";return(0,r.jsx)(m,{className:(0,i.cn)(d({variant:s,size:n,className:a})),ref:t,...c})});o.displayName="Button"},35007:(e,t,a)=>{"use strict";a.d(t,{Wu:()=>o,ZB:()=>d,Zp:()=>n,aR:()=>i});var r=a(95155),s=a(12115),l=a(29602);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...s})});n.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("font-semibold leading-none tracking-tight",a),...s})});d.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});o.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},50745:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>f,gC:()=>h,l6:()=>c,yv:()=>m});var r=a(95155),s=a(12115),l=a(95204),n=a(51719),i=a(91902),d=a(98867),o=a(29602);let c=l.bL;l.YJ;let m=l.WT,u=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,o.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[s,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=l.PP.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})});x.displayName=l.wn.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,position:n="popper",...i}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,r.jsx)(p,{}),(0,r.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(x,{})]})})});h.displayName=l.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",a),...s})}).displayName=l.JU.displayName;let f=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,r.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:s})]})});f.displayName=l.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=l.wv.displayName},90051:(e,t,a)=>{"use strict";a.d(t,{Gv:()=>l,L6:()=>r,S8:()=>s});let r=[{value:"gpt-4o",label:"GPT-4o",fullName:"gpt-4o-2024-11-20",color:"oklch(0.55 0.2 270)"},{value:"haiku",label:"Claude Haiku",fullName:"claude-3-haiku-20240307",color:"oklch(0.6 0.18 50)"},{value:"mini",label:"GPT-4o-mini",fullName:"gpt-4o-mini-2024-07-18",color:"oklch(0.55 0.18 300)"}],s=[{value:"vA",label:"Version A",description:"Implicit direct prediction"},{value:"vB",label:"Version B",description:"CoT two-step reasoning"}],l={Low:"oklch(0.55 0.2 25)",Mid:"oklch(0.6 0.15 60)",High:"oklch(0.5 0.18 145)"}},29602:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var r=a(43463),s=a(69795);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},53608:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(67401).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[525,644,441,517,358],()=>t(68433)),_N_E=e.O()}]);